{// 引入标签库 }
<tagLib name="html" />
<include file="Public:header" />
<load href='__TMPL__Common/js/jquery.bgiframe.js' />
<load href='__TMPL__Common/js/jquery.weebox.js' />
<load href='__TMPL__Common/style/weebox.css' />
<load href='__TMPL__Common/js/carriage_template.js' />
<script type="text/javascript" src="<PHP>echo APP_ROOT;</PHP>/public/runtime/region.js"></script>
<style type="text/css">

.postage-detail{
	margin: 5px 0;
	padding: 5px;
	border: 1px solid #b2d1ff;
	width: 800px;
}
.postage-detail .entity{

}
.postage-detail .entity .default{
	margin-top: 5px;
	padding: 0 15px 5px;
	line-height: 32px;
	background-color: #f3feed;
}
.postage-detail .entity .default input{
	width: 50px;
	text-align: right;
}
.tbl-except table {
	width: 100%;
	border-width: 1px 0 0 1px;
	border-color: #bbb;
	border-style: solid;
}
.tbl-except th {
	height: 32px;
	font-weight: 400;
	background-color: #f5f5f5;
}
.tbl-except td {
	padding: 3px 5px;
}
.tbl-except td {
	border-width: 0 1px 1px 0;
	border-color: #bbb;
	border-style: solid;
	text-align: center;
}
.postage-detail .entity .tbl-except .input-text{
	width: 50px;
	text-align: right;
}
.tbl-except {
	margin-top: 10px;
}
.tbl-except .edit {
	float: right;
}
.tbl-except .area-group {
	padding-right: 3em;
	display: block;
}
.tbl-except .cell-area {
	text-align: left;
	width: 282px;
	font-size: 12px;
}
.tbl-attach {
	margin-top: 5px;
	line-height: 24px;
}


/*选择城市样式*/
.dialog-areas {
	position: absolute;
	width: 580px;
	border: 1px solid #c4d5df;
	background-color: #fff;
}
.dialog-areas .ks-ext-close {
	position: absolute;
	top: 5px;
	right: 5px;
	font-size: 10px;
}
.dialog-areas .title {
	padding-left: 10px;
	height: 22px;
	line-height: 22px;
	font-weight: 700;
	background-color: #e9f1f4;
	border-width: 1px;
	border-style: solid;
	border-color: #fff #fff #c4d5df;
}
.dialog-areas li {
	overflow: visible;
	border-bottom: 1px solid #c4d5df;
}
.dialog-areas label {
	margin: 0 1px;
	vertical-align: middle;
	display: inline-block;
}
.dcity {
	vertical-align: middle;
	display: block;
	z-index: 1;
}
.gcity, .province-list {
	display: inline-block;
}
.dialog-areas .even {
	background-color: #ecf4ff;
}
.ecity {
	position: relative;
	float: left;
	margin-right: 1px;
	padding-right: 8px;
	height: 38px;
	width: 80px;
}
.province-list {
	width: 450px;
}
.dialog-areas li span.group-label {
	margin-right: 5px;
	padding: 10px 0 5px 10px;
	display: inline-block;
	width: 70px;
	font-weight: 700;
}
.dialog-areas .even span.gareas {
	background-color: #ECF4FF;
	border-color: #ecf4ff;
}
.dialog-areas span.gareas {
	white-space: nowrap;
	margin-right: 3px;
	padding: 7px 4px 1px;
	display: inline-block;
	position: relative;
	height: 17px;
	border: 1px solid #fff;
}
.dialog-areas input, .dialog-areas button {
	margin: 0 1px;
	vertical-align: middle;
}
.check_num {
	color: #F60;
	font-size: 12px;
	letter-spacing: -1px;
}
.trigger {
	width: 8px;
	height: 8px;
	padding: 2px;
	cursor: pointer;
}
.showCityPop {
	z-index: 55556;
}
.dialog-areas .even .showCityPop .gareas {
	background-color: #FFFEC6;
	border-color: #f7e4a5 #f7e4a5 #FFFEC6;
}
.dialog-areas .showCityPop .gareas {
	background-color: #FFFEC6;
	border: solid 1px #f7e4a5;
	border-bottom: solid 1px #FFFEC6;
	z-index: 56000;
	padding-bottom: 4px;
}
.citys {
	background-color: #FFFEC6;
	position: absolute;
	float: right;
	border: solid 1px #f7e4a5;
	z-index: 20000;
	top: 28px;
	left: 0;
	width: 214px;
	display: none;
	white-space: wrap;
}
.dialog-areas li span.areas {
	margin-right: 3px;
	padding: 7px 0 1px 4px;
	display: inline-block;
}
.citys span {
	line-height: 2;
	margin-right: 2px;
}
.dialog-areas .btns {
	padding: 5px 0 5px 10px;
	margin-left: 430px;
}
.dialog-areas button {
	margin-right: 5px;
	padding: 2px 3px;
}
.input-err{
	border: 1px solid #ff8080;
	background-color: #fff2f2;
}

#postage-tpl span.msg {
	margin-right: 3px;
}
.msg span.error {
	font-size: 12px;
	line-height: 24px;
	padding: 0 5px;
	margin-top: 3px;
	margin-right: 3px;
	display: inline-block;
	border: 1px solid;
	border-color: #ff8080;
	background-color: #fff2f2;
}
</style>
<div class="main">
<div class="main_title">{%EDIT} <a href="{:u("CarriageTemplate/index")}" class="back_list">{%BACK_LIST}</a></div>
<div class="blank5"></div>
<form name="edit" action="__APP__" method="post" enctype="multipart/form-data" >
<table class="form" cellpadding=0 cellspacing=0>
	<tr>
		<td colspan=2 class="topTd"></td>
	</tr>
	<tr>
		<td class="item_title">模板名称:</td>
		<td class="item_input"><input type="text" class="textbox require" name="name" value="{$data.name}"/></td>
	</tr>
	<tr>
		<td class="item_title">商品地址:</td>
		<td class="item_input">
			<select name="region_lv1" class="ui-select region_select" height="300" style="display: none;">
				<option selected="selected" value="1">中国</option>
			</select>

			<select name="region_lv2" class="ui-select region_select" height="300">
				<option value="0">请选择省</option>
				<foreach name="region_lv2" item="lv2">
					<option <if condition="$lv2['selected'] eq 1">selected="selected"</if> value="{$lv2.id}">{$lv2.name}</option>
				</foreach>
			</select>

			<select name="region_lv3" class="ui-select region_select" height="300">
				<option value="0">请选择城市</option>
				<foreach name="region_lv3" item="lv3">
					<option <if condition="$lv3['selected'] eq 1">selected="selected"</if> value="{$lv3.id}">{$lv3.name}</option>
				</foreach>
			</select>
			<if condition="$region_lv4">
				<select name="region_lv4" class="ui-select region_select" height="300">
					<option value="0">请选择区县</option>
					<foreach name="region_lv4" item="lv4">
						<option <if condition="$lv4['selected'] eq 1">selected="selected"</if> value="{$lv4.id}">{$lv4.name}</option>
					</foreach>
				</select>
			</if>
		</td>
	</tr>
	<tr>
		<td class="item_title">是否包邮:</td>
		<td class="item_input">
			<label><input type="radio"  name="carriage_type" <if condition="$data['carriage_type'] eq 1"> checked="checked" </if> value="1"/>自定义运费</label>&nbsp;<label><input type="radio" name="carriage_type" value="2" <if condition="$data['carriage_type'] eq 2"> checked="checked" </if>/>卖家承担运费</label>
		</td>
	</tr>
	<tr class="carriage_type_1">
		<td class="item_title">计价方式:</td>
		<td class="item_input">
			<label><input type="radio"  name="valuation_type" <if condition="$data['valuation_type'] eq 1">checked="checked" </if> value="1"/>按件数</label>&nbsp;<label><input type="radio" name="valuation_type" value="2" <if condition="$data['valuation_type'] eq 2">checked="checked" </if>/>按重量</label>
		</td>
	</tr>
	<tr class="carriage_type_1 postage-detail-box" style="display: none;">
		<td class="item_title">
		运费详情:
		</td>
		<td class="item_input">
			<div class="postage-detail" >

			</div>
		</td>
	</tr>
	<tr>
		<td class="item_title"></td>
		<td class="item_input">
			<!--隐藏元素-->
			<intpu type="hidden" name="supplier_id" value="{$vo.supplier_id}"/>
			<input type="hidden" name="tbl_except_group" value=""/>
			<input type="hidden" name="id" value="{$data.id}"/>
			<input type="hidden" name="{:conf("VAR_MODULE")}" value="CarriageTemplate" />
			<input type="hidden" name="{:conf("VAR_ACTION")}" value="update" />
			<!--隐藏元素-->
			<input class="button submit_btn" type="button" value="{%EDIT}" />
			<input type="reset" class="button" value="{%RESET}" />
		</td>
	</tr>
	<tr>
		<td colspan=2 class="bottomTd"></td>
	</tr>
</table>	 
</form>
</div>
<div class="valuation_type_1" style="display: none;">
	<div class="entity">
		<div class="default">
			默认运费：<input type="text" name="express_start" data-field="start" value="<php>echo intval($default_carriage['express_start']);</php>" class="textbox" maxlength="6"  onkeypress="return myNumberic(event,0)"  aria-label="默认运费件数"> <span class="unit">件</span>内，
			<input type="text"  name="express_postage" data-field="postage" value="{$default_carriage.express_postage}"  class="textbox" maxlength="6"   onkeypress="return myNumberic(event)"  aria-label="默认运费价格"> 元，
			每增加 <input type="text" name="express_plus" data-field="plus" value="<php>echo intval($default_carriage['express_plus']);</php>"  class="textbox"  maxlength="6"  onkeypress="return myNumberic(event,0)"   aria-label="每加件"> 件，
			增加运费 <input type="text" name="express_postage_plus" data-field="postage_plus" value="{$default_carriage.express_postage_plus}"  class="textbox" maxlength="6" onkeypress="return myNumberic(event)"  aria-label="加件运费"> 元
			<div class="J_DefaultMessage"></div>
		</div>
		<div class="tbl-except" style=" <if condition="$carriage_list"><else/>display: none;</if> ">
			<table border="0" cellpadding="0" cellspacing="0">
				<colgroup>
					<col class="col-area">
					<col class="col-start">
					<col class="col-postage">
					<col class="col-plus">
					<col class="col-postageplus">
					<col class="col-action">
				</colgroup>
				<thead>
				<tr>
					<th>运送到</th>
					<th>首件(件)</th>
					<th>首费(元)</th>
					<th>续件(件)</th>
					<th>续费(元)</th>
					<th>操作</th>
				</tr>
				</thead>
				<tbody>
				<?php $i=1; ?>
				<foreach name="carriage_list" item="carriage_item" key="key">
					<tr data-group="n<?php echo $i;?>">
						<td class="cell-area">
							<a href="#" class="acc_popup edit J_EditArea" title="编辑运送区域" >编辑</a>
							<div class="area-group">
								<p>{$carriage_item.show_city_name}</p>
							</div>
							<input type="hidden" data-field="express_areas" name="express_areas_n<?php echo $i;?>" value="{$carriage_item.region_ids}"/>
						</td>
						<td><input type="text" name="express_start_n<?php echo $i;?>" data-field="start" value="<php>echo intval($carriage_item['express_start']);</php>" class="input-text " maxlength="6"  onkeypress="return myNumberic(event,0)" ></td>
						<td><input type="text" name="express_postage_n<?php echo $i;?>" data-field="postage" value="{$carriage_item.express_postage}" class="input-text " maxlength="6" onkeypress="return myNumberic(event)" ></td>
						<td><input type="text" name="express_plus_n<?php echo $i;?>" data-field="plus" value="<php>echo intval($carriage_item['express_plus']);</php>" class="input-text " maxlength="6"  onkeypress="return myNumberic(event,0)" ></td>
						<td><input type="text" name="express_postage_plus_n<?php echo $i;?>" data-field="postage_plus" value="{$carriage_item.express_postage_plus}" class="input-text " maxlength="6" onkeypress="return myNumberic(event)" ></td>
						<td><a href="#" class="J_DeleteRule">删除</a></td>
					</tr>
					<?php $i++; ?>
				</foreach>
				</tbody>
			</table>
		</div>
		<div class="tbl-attach">
			<div class="J_SpecialMessage"></div>
			<a href="#" class=" J_AddRule">为指定地区城市设置运费</a>
		</div>
	</div>
</div>
<div class="valuation_type_2" style="display: none;">
	<div class="entity">
		<div class="default">
			默认运费：<input type="text" name="express_start" data-field="start" value="<php>echo number_format($default_carriage['express_start'],1);</php>" class="textbox"  maxlength="6" onkeypress="return myNumberic(event,1)" aria-label="默认运费重数"> kg内，
			<input type="text"  name="express_postage" data-field="postage" value="{$default_carriage.express_postage}"  class="textbox" maxlength="6"  onkeypress="return myNumberic(event)" aria-label="默认运费价格"> 元，
			每增加 <input type="text" name="express_plus" data-field="plus" value="<php>echo number_format($default_carriage['express_plus'],1);</php>"  class="textbox" maxlength="6"  onkeypress="return myNumberic(event,1)" aria-label="每加重"> kg，
			增加运费 <input type="text" name="express_postage_plus" data-field="postage_plus" value="{$default_carriage.express_postage_plus}"  class="textbox" maxlength="6"  onkeypress="return myNumberic(event)" aria-label="加重运费"> 元
			<div class="J_DefaultMessage"></div>
		</div>
		<div class="tbl-except" <if condition="$carriage_list"><else/>style="display: none;"</if>  >
			<table border="0" cellpadding="0" cellspacing="0">
				<colgroup>
					<col class="col-area">
					<col class="col-start">
					<col class="col-postage">
					<col class="col-plus">
					<col class="col-postageplus">
					<col class="col-action">
				</colgroup>
				<thead>
				<tr>
					<th>运送到</th>
					<th>首重(kg)</th>
					<th>首费(元)</th>
					<th>续重(kg)</th>
					<th>续费(元)</th>
					<th>操作</th>
				</tr>
				</thead>
				<tbody>
				<?php $i=1; ?>
				<foreach name="carriage_list" item="carriage_item" key="key">

				<tr data-group="n<?php echo $i;?>">
					<td class="cell-area">
						<a href="#" class="acc_popup edit J_EditArea" title="编辑运送区域" >编辑</a>
						<div class="area-group">
							<p>{$carriage_item.show_city_name}</p>
							</div>
						<input type="hidden" data-field="express_areas" name="express_areas_n<?php echo $i;?>" value="{$carriage_item.region_ids}"/>
						</td>
					<td><input type="text" name="express_start_n<?php echo $i;?>" data-field="start" value="<php>echo number_format($carriage_item['express_start'],1);</php>" class="input-text "  maxlength="6" onkeypress="return myNumberic(event,1)" ></td>
					<td><input type="text" name="express_postage_n<?php echo $i;?>" data-field="postage" value="{$carriage_item.express_postage}" class="input-text " maxlength="6"  onkeypress="return myNumberic(event)" ></td>
					<td><input type="text" name="express_plus_n<?php echo $i;?>" data-field="plus" value="<php>echo number_format($carriage_item['express_plus'],1);</php>" class="input-text " maxlength="6"  onkeypress="return myNumberic(event,1)" ></td>
					<td><input type="text" name="express_postage_plus_n<?php echo $i;?>" data-field="postage_plus" value="{$carriage_item.express_postage_plus}" class="input-text "  maxlength="6" onkeypress="return myNumberic(event)" ></td>
					<td><a href="#" class="J_DeleteRule">删除</a></td>
					</tr>
					<?php $i++; ?>
					</foreach>
				</tbody>
			</table>
		</div>
		<div class="tbl-attach">
			<div class="J_SpecialMessage"></div>
			<a href="#" class="J_AddRule">为指定地区城市设置运费</a>
		</div>
	</div>
</div>
<div class="ks-dialog dialog-areas" style="display: none;">
	<a tabindex="0" href='javascript:void("关闭")' role="button" style="z-index:9" class="ks-ext-close"><span class="ks-ext-close-x">关闭</span></a>
	<div class="ks-contentbox">
		<div class="ks-stdmod-header" id="ks-dialog-header7242"><div class="title">选择区域</div></div>

			<form method="post">
				<ul id="citylist">
					<?php $i=1; ?>
					<foreach name="delivery_regions" item="regions" key="key">
						<?php $i++; ?>
						<li <?php if($i%2!=0){echo 'class="even"';} ?>>
						<div class="dcity">
							<div class="ecity gcity">
								<span class="group-label"><input type="checkbox" class="J_Group" id="group_{$key}"><label for="group_{$key}">{$regions.name}</label></span>
							</div>
							<div class="province-list">
								<foreach name="regions.province_arr" item="province">
									<div class="ecity">
										<span class="gareas"><input type="checkbox" value="{$province.id}" id="province_{$province.id}" class="J_Province" ><label for="province_{$province.id}">{$province.name}</label><span class="check_num" style="display: none;"></span><img class="trigger" src="__TMPL__Common/images/jiantou.gif"></span>
										<div class="citys">
											<foreach name="province.city_list" item="city">
												<span class="areas"><input type="checkbox" value="{$city.id}" id="city_{$city.id}" class="J_City"><label for="city_{$city.id}">{$city.name}</label></span>
											</foreach>
											<p style="text-align:right;"><input type="button" value="关闭" class="close_button"></p>
										</div>
									</div>
								</foreach>
							</div>
						</div>
						</li>
					</foreach>

				</ul>
				<div class="btns">
					<input type="hidden" name="edit_citys_index" value="0">
					<button type="submit" class="J_Submit">确定</button><button type="button" class="J_Cancel">取消</button>
				</div>
			</form>

	</div>
</div>

<include file="Public:footer" />